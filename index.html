<!DOCTYPE html>
<html lang="en">
<head>
  <title>Reporte Diario AIT</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
const cys = { 
    regiones : [  { nombre: 'CENTRO-OCCIDENTE',
                    gerente: 'ROBERT TOYO',
                    plantas : [
                      { 
                        nombre: 'P/D CARDÓN',
                        responsable: 'ROBERT TOYO'
                      }
                    ]
                  },
                  { nombre: 'OCCIDENTE',
                    gerente: 'ALEXANDER PIRELA',
                    plantas : [
                      { 
                        nombre: 'P/D SAN LORENZO',
                        responsable: 'CESAR HERNÁNDEZ'
                      },
                      { 
                        nombre: 'P/D BAJO GRANDE',
                        responsable: ' (ADAN URDANETA'
                      }
                    ]
                  },
                  { nombre: 'CENTRO-SUR',
                    gerente: 'GUILLERMO PÉREZ',
                    plantas : [
                      { 
                        nombre: 'P/D EL VIGÍA',
                        responsable: 'JOSÉ LUIS ANSELMI'
                      }
                    ]
                  },
                  { nombre: 'ORIENTE-NORTE',
                    gerente: 'CARLOS GONZALEZ',
                    plantas : [
                      { 
                        nombre: 'P/D PLC',
                        responsable: 'DOUGLAS ARAUJO'
                      },
                      { 
                        nombre: 'P/D EL GUAMACHE',
                        responsable: 'JESÚS ROSAS'
                      }
                    ]
                  },
                  { nombre: 'ORIENTE-SUR',
                    gerente: 'PEDRO TINEO',
                    plantas : [
                      { 
                        nombre: 'P/D MATURÍN',
                        responsable: 'EUCALIP RODRÍGUEZ'
                      }
                    ]
                  },
                  { nombre: 'FAJA',
                    gerente: 'MIGUEL RIVERA',
                    plantas : [
                      { 
                        nombre: 'P/D SAN TOMÉ',
                        responsable: 'YOVANY CARNEIRO'
                      },
                      { 
                        nombre: 'P/D CIUDAD BOLÍVAR',
                        responsable: 'ARMANDO BARTOLOZZI'
                      },
                      { 
                        nombre: 'P/D PUERTO ORDAZ',
                        responsable: 'ARMANDO BARTOLOZZI'
                      },
                      { 
                        nombre: 'P/D PUERTO AYACUCHO',
                        responsable: 'RODOLFO LANDAETA'
                      }
                    ]
                  },
                  { nombre: 'CENTRO',
                    gerente: 'VLADIMIR MACHADO',
                    plantas : [
                      { 
                        nombre: 'P/D EL PALITO',
                        responsable: 'NILDA LUGO'
                      },
                      { 
                        nombre: 'P/D YAGUA',
                        responsable: 'CARLOS ALDANA'
                      },
                      { 
                        nombre: 'P/D MAPORAL',
                        responsable: 'RENNA BRITO'
                      },
                      { 
                        nombre: 'P/D GUATIRE',
                        responsable: 'DANIEL MACHADO'
                      },
                      { 
                        nombre: 'P/D CARENERO',
                        responsable: 'DANIEL MACHADO'
                      },
                      { 
                        nombre: 'P/D CATIA LA MAR',
                        responsable: 'CARLOS VOLCÁN'
                      }
                    ]
                  }
    ]

}
</script>

</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#"><img src="logoPDVSA.png"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">Plantas</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Estaciones de Combustible</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Oficinas</a>
        </li>  
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">Reportes</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Primer Reporte</a></li>
            <li><a class="dropdown-item" href="#">Segundo Reporte</a></li>
            <li><a class="dropdown-item" href="#">Tercer Reporte</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid mt-3">
  
  <h3>REPORTE DIARIO DEL ESTADO DE LA PLATAFORMA TECNOLÓGICA (AIT)</h3>

  <form onsubmit="return enviarPorWS(this);" action="">
    <div class="mb-3 mt-3">
    <label for="fecha">Fecha:</label>
    <input type="date" id="fecha" name="fecha">
    </div>
    
    <div class="mb-3 mt-3">
    <label for="hora">Hora:</label>
    <input type="time" id="hora" name="hora">
    </div>
    
    <div class="mb-3 mt-3">
    <label for="region" class="form-label">Región:</label>
    <select class="form-select" id="region" name="region" onchange="cambioRegion(this)">
    </select>
    </div>
    
    <div class="mb-3 mt-3">
    <label for="planta" class="form-label">Planta:</label>
    <select class="form-select" id="planta" name="planta">
    </select>
    </div>

    <script>
        function cambioColor(obj)  {
            let oTA = document.getElementById('ta-'+obj.name);
            if (obj.value == "verde")   oTA.setAttribute("style","display:none")
            else    oTA.setAttribute("style","display:block");
        }
    </script>

    <table>
        <tbody>
          <tr>
            <td>Aplicación SCLi-SAP</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="scli-zap" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="scli-zap" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="scli-zap" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-scli-zap" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-scli-zap" rows="3"></textarea></td>
          </tr>
          <tr>
            <th>Plataforma Servidores</th>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Plataforma Virtualizada:</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="pla-vir" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="pla-vir" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="pla-vir" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-pla-vir" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-pla-vir" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Servidor A:</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="serv-a" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="serv-a" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="serv-a" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-serv-a" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-serv-a" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Servidor B:</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="serv-b" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="serv-b" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="serv-b" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-serv-b" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-serv-b" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Servidor C:</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="serv-c" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="serv-c" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="serv-c" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-serv-c" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-serv-c" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Servidor D:</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="serv-d" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="serv-d" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="serv-d" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-serv-d" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-serv-d" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>Plataforma Impresión</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="pla-imp" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="pla-imp" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="pla-imp" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-pla-imp" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-pla-imp" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>Comunicaciones</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="pla-com" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="pla-com" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="pla-com" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-pla-com" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-pla-com" rows="3"></textarea></td>
          </tr>
          <tr>
            <td>Servicios Auxiliares</td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-success" name="ser-aux" value="verde"    onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-warning" name="ser-aux" value="amarillo" onchange="cambioColor(this)"></td>
            <td>&nbsp;<input type="radio" class="form-check-input bg-danger"  name="ser-aux" value="rojo"     onchange="cambioColor(this)"></td>
          </tr>
          <tr>
             <td colspan="4" align="right" id="ta-ser-aux" style="display:none">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<textarea name="ta-ser-aux" rows="3"></textarea></td>
          </tr>
          </tr>
        </tbody>
    </table>   

    <div class="mb-3 mt-3">
      <label for="reportado" class="form-label">Reportado por:</label>
      <input type="text" class="form-control" id="reportado" name="reportado">
    </div>
    <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalWS">Submit</button>
  </form>
  
</div>

<!-- The Modal -->
<div class="modal" id="modalWS">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Reporte</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
            <div class="mb-3 mt-3">
                <label for="comment">Mensaje por Whatsapp:</label>
                <textarea id="mensajeWS" class="form-control" rows="10" id="comment" name="text"></textarea>
           </div>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" onclick="copiarAlPortapapeles(document.getElementById('mensajeWS').innerHTML)">Copiar</button>
      </div>

    </div>
  </div>
</div>
</body>
</html>

<script>
  let regiones = [];
  for (var i = 0; i < cys.regiones.length; i++) regiones.push(cys.regiones[i].nombre+' ('+cys.regiones[i].gerente+')');
  cargarSelect(document.getElementById('region'), regiones);                                                       
  function cargarSelect (obj, lista)  {
      obj.innerHTML = "";
      for (var i = 0; i < lista.length; i++)    {
        var option = document.createElement("option");
        option.value = i;
        option.innerHTML = lista[i];
        obj.appendChild(option);
      }
      obj.selectedIndex=0;
   }
   cambioRegion(document.getElementById('region'));
   function cambioRegion(obj)   {
       const region = cys.regiones[obj.options[obj.selectedIndex].value];
       let plantas = [];
       for (var i = 0; i < region.plantas.length; i++) plantas.push(region.plantas[i].nombre+' ('+region.plantas[i].responsable+')');
       cargarSelect(document.getElementById('planta'), plantas);                                                       
   }
  function determinar(rv) {
    if (rv == 'verde')  {
      return 'Funcionando';
    } else if (rv == 'amarillo')  {
      return 'Con fallas';
    } else if (rv == 'rojo')  {
      return 'No funciona';
    } else {
      return 'No aplica';
    }
  }
  function enviarPorWS(oForm)  {
    let msg ='';
    msg += '*Rep Diario Plataforma Tecnológica*\n';
    msg += '('+$('#fecha').val()+' '+$('#hora').val()+')\n';
    var select = document.getElementById('region');
    var text = select.options[select.selectedIndex].text;
    msg += 'Región: _'+text+'_\n';
    select = document.getElementById('planta');
    text = select.options[select.selectedIndex].text;
    msg += 'Planta: _'+text+'_\n';
    let radioValor = $('input[name=scli-zap]:checked').val();
    msg += '\n*Plataforma Aplicaciones*\n';
    msg += 'Aplicación SCLi-SAP: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-scli-zap]').val()+'```\n';
    msg += '\n*Plataforma Servidores*\n';
    radioValor = $('input[name=pla-vir]:checked').val();
    msg += 'Plataforma Virtualizada: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-pla-vir]').val()+'```\n';
    radioValor = $('input[name=serv-a]:checked').val();
    msg += 'Servidor A: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-serv-a]').val()+'```\n';
    radioValor = $('input[name=serv-b]:checked').val();
    msg += 'Servidor B: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-serv-b]').val()+'```\n';
    radioValor = $('input[name=serv-c]:checked').val();
    msg += 'Servidor C: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-serv-c]').val()+'```\n';
    radioValor = $('input[name=serv-d]:checked').val();
    msg += 'Servidor D: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-serv-d]').val()+'```\n';
    radioValor = $('input[name=pla-imp]:checked').val();
    msg += 'Plataforma de Impresión: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-pla-imp]').val()+'```\n';
    radioValor = $('input[name=pla-com]:checked').val();
    msg += '\nPlataforma de Comunicaciones: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-pla-com]').val()+'```\n';
    radioValor = $('input[name=ser-aux]:checked').val();
    msg += '\nServicios Auxiliares: _'+determinar(radioValor)+'_\n';
    if (radioValor == 'amarillo' || radioValor == 'rojo') msg += '```'+$('textarea[name=ta-ser-aux]').val()+'```\n\n';
    msg += '\nReportado por: _'+$('#reportado').val()+'_\n';
    document.getElementById('mensajeWS').innerHTML = msg;
    enviarMensajeWS('+584165670214','v3eigq8fam0kl7gk','instance20086',msg);
    enviarMensajeWS('+584166843149','v3eigq8fam0kl7gk','instance20086',msg);
    return false;
  }
  function enviarMensajeWS	(cel, token, instancia, msj)	{
	var settings = {
		"async": true,
		"crossDomain": true,
		"url": "https://api.ultramsg.com/"+instancia+"/messages/chat",
		"method": "POST",
		"headers": {},
		"data":	{
			"token": token,
			"to": cel,
			"body": msj,
			"priority": "1",
			"referenceId": ""
		}
	}
  function copiarAlPortapapeles(texto) {
    var elementoTemporal = document.createElement("textarea");
    elementoTemporal.value = texto;
    document.body.appendChild(elementoTemporal);
    elementoTemporal.select();
    document.execCommand("copy");
    document.body.removeChild(elementoTemporal);
  }
  $.ajax(settings).done(function (response) {
		console.log(response);
	});
}
</script>
